
# Customer Journey: Há»‡ thá»‘ng Onboarding ToÃ n diá»‡n

## Tá»•ng quan Kiáº¿n trÃºc 3 Lá»›p

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BLUECORE ONBOARDING SYSTEM                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  LAYER 1: PLATFORM                LAYER 2: TENANT                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ğŸ‘‹ Welcome         â”‚          â”‚ ğŸ¢ Company Profile â”‚             â”‚
â”‚  â”‚ ğŸ‘¤ Role Selection  â”‚    â†’     â”‚ ğŸ“Š Industry/Scale  â”‚             â”‚
â”‚  â”‚ ğŸ¯ Dashboard Intro â”‚          â”‚ ğŸ”Œ Data Sources    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚            â”‚                              â”‚                          â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                           â–¼                                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                    â”‚  Portal Hub  â”‚                                 â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                           â”‚                                          â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚            â–¼              â–¼              â–¼                          â”‚
â”‚   LAYER 3: MODULE   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   MDP   â”‚   â”‚   CDP   â”‚                       â”‚
â”‚   â”‚   FDP   â”‚       â”‚ Wizard  â”‚   â”‚ Wizard  â”‚                       â”‚
â”‚   â”‚ Wizard  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Customer Journey Chi tiáº¿t

### Giai Ä‘oáº¡n 1: ÄÄƒng kÃ½ â†’ Platform Onboarding

| BÆ°á»›c | MÃ n hÃ¬nh | Má»¥c Ä‘Ã­ch | Dá»¯ liá»‡u thu tháº­p |
|------|----------|----------|------------------|
| 1.1 | Welcome Screen | ChÃ o má»«ng, giá»›i thiá»‡u nhanh Bluecore | - |
| 1.2 | Role Selection | XÃ¡c Ä‘á»‹nh vai trÃ² ngÆ°á»i dÃ¹ng | `profile.role`: CEO/CFO/CMO/COO/Marketer/Accountant |
| 1.3 | Dashboard Preview | Show preview dashboard phÃ¹ há»£p vá»›i role | - |

### Giai Ä‘oáº¡n 2: Tenant Onboarding

| BÆ°á»›c | MÃ n hÃ¬nh | Má»¥c Ä‘Ã­ch | Dá»¯ liá»‡u thu tháº­p |
|------|----------|----------|------------------|
| 2.1 | Company Profile | ThÃ´ng tin cÆ¡ báº£n doanh nghiá»‡p | `tenant.name`, `tenant.logo` |
| 2.2 | Industry Selection | XÃ¡c Ä‘á»‹nh ngÃ nh (Retail/D2C/B2B/F&B) | `tenant.industry` |
| 2.3 | Scale & Revenue | Quy mÃ´ vÃ  doanh thu thÃ¡ng | `tenant.scale`, `tenant.monthly_revenue` |
| 2.4 | Data Sources Overview | Chá»n cÃ¡c ná»n táº£ng Ä‘ang sá»­ dá»¥ng | `tenant.data_sources[]` |

### Giai Ä‘oáº¡n 3: Module Onboarding (theo module Ä‘áº§u tiÃªn user vÃ o)

| BÆ°á»›c | MÃ n hÃ¬nh | Má»¥c Ä‘Ã­ch |
|------|----------|----------|
| 3.1 | Nguá»“n dá»¯ liá»‡u | Chá»n chi tiáº¿t sub-sources |
| 3.2 | XÃ¡c nháº­n dá»¯ liá»‡u | Xem dá»¯ liá»‡u inferred + bá»• sung |
| 3.3 | Káº¿ hoáº¡ch Import | Roadmap: Connect/Import/Skip |

---

## Database Schema Changes

### 1. ThÃªm cá»™t vÃ o báº£ng `profiles`

```sql
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS 
  onboarding_status TEXT DEFAULT 'pending' 
  CHECK (onboarding_status IN ('pending', 'platform_done', 'completed', 'skipped'));

ALTER TABLE profiles ADD COLUMN IF NOT EXISTS 
  user_role TEXT 
  CHECK (user_role IN ('ceo', 'cfo', 'cmo', 'coo', 'marketer', 'accountant', 'admin'));

ALTER TABLE profiles ADD COLUMN IF NOT EXISTS 
  onboarding_completed_at TIMESTAMPTZ;
```

### 2. ThÃªm cá»™t vÃ o báº£ng `tenants`

```sql
ALTER TABLE tenants ADD COLUMN IF NOT EXISTS 
  onboarding_status TEXT DEFAULT 'pending' 
  CHECK (onboarding_status IN ('pending', 'in_progress', 'completed', 'skipped'));

ALTER TABLE tenants ADD COLUMN IF NOT EXISTS 
  industry TEXT;

ALTER TABLE tenants ADD COLUMN IF NOT EXISTS 
  company_scale TEXT 
  CHECK (company_scale IN ('startup', 'sme', 'enterprise'));

ALTER TABLE tenants ADD COLUMN IF NOT EXISTS 
  monthly_revenue_range TEXT;

ALTER TABLE tenants ADD COLUMN IF NOT EXISTS 
  data_sources JSONB DEFAULT '[]'::jsonb;
```

---

## File Structure Má»›i

```text
src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ onboarding/
â”‚       â”œâ”€â”€ index.ts                    # Export all
â”‚       â”œâ”€â”€ WelcomePage.tsx             # Step 1.1
â”‚       â”œâ”€â”€ RoleSelectionPage.tsx       # Step 1.2
â”‚       â”œâ”€â”€ DashboardPreviewPage.tsx    # Step 1.3
â”‚       â”œâ”€â”€ CompanyProfilePage.tsx      # Step 2.1
â”‚       â”œâ”€â”€ IndustrySelectionPage.tsx   # Step 2.2
â”‚       â”œâ”€â”€ ScaleRevenuePage.tsx        # Step 2.3
â”‚       â”œâ”€â”€ DataSourcesOverviewPage.tsx # Step 2.4
â”‚       â””â”€â”€ DataAssessmentPage.tsx      # Existing (Module layer)
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ onboarding/
â”‚       â”œâ”€â”€ OnboardingGuard.tsx         # Global guard component
â”‚       â”œâ”€â”€ OnboardingProgress.tsx      # Progress indicator
â”‚       â”œâ”€â”€ RoleCard.tsx                # Role selection card
â”‚       â”œâ”€â”€ IndustryCard.tsx            # Industry card
â”‚       â””â”€â”€ ScaleSlider.tsx             # Revenue scale slider
â”‚
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useOnboardingStatus.ts          # Check & update status
â”‚   â””â”€â”€ useOnboardingFlow.ts            # Navigation logic
â”‚
â””â”€â”€ lib/
    â””â”€â”€ onboardingConfig.ts             # Steps config, validation
```

---

## Routing Changes (App.tsx)

```typescript
// Onboarding Routes - Platform Layer
<Route path="/onboarding/welcome" element={<WelcomePage />} />
<Route path="/onboarding/role" element={<RoleSelectionPage />} />
<Route path="/onboarding/preview" element={<DashboardPreviewPage />} />

// Onboarding Routes - Tenant Layer  
<Route path="/onboarding/company" element={<CompanyProfilePage />} />
<Route path="/onboarding/industry" element={<IndustrySelectionPage />} />
<Route path="/onboarding/scale" element={<ScaleRevenuePage />} />
<Route path="/onboarding/sources" element={<DataSourcesOverviewPage />} />

// Existing Module Layer
<Route path="/onboarding/data-assessment/:moduleKey" element={<DataAssessmentPage />} />
```

---

## OnboardingGuard Logic

```typescript
// src/components/onboarding/OnboardingGuard.tsx
function OnboardingGuard({ children }) {
  const { profile, tenant } = useOnboardingStatus();
  
  // Check profile onboarding
  if (profile.onboarding_status === 'pending') {
    return <Navigate to="/onboarding/welcome" />;
  }
  
  // Check tenant onboarding (if platform done)
  if (profile.onboarding_status === 'platform_done' && 
      tenant.onboarding_status === 'pending') {
    return <Navigate to="/onboarding/company" />;
  }
  
  return children;
}
```

---

## Implementation Priority

### Phase 1: Core Infrastructure
1. Database migration (profiles + tenants columns)
2. `useOnboardingStatus` hook
3. `OnboardingGuard` component
4. Update `useAuthRedirect` to check onboarding

### Phase 2: Platform Layer (User)
1. WelcomePage with animation
2. RoleSelectionPage (6 roles)
3. DashboardPreviewPage (role-based preview)

### Phase 3: Tenant Layer (Company)
1. CompanyProfilePage
2. IndustrySelectionPage (4 industries)
3. ScaleRevenuePage
4. DataSourcesOverviewPage

### Phase 4: Integration
1. Connect all routes in App.tsx
2. Test full flow
3. Add skip functionality
4. Analytics tracking

---

## UX Considerations

### Visual Design
- Full-screen wizard vá»›i progress indicator
- Card-based selection (khÃ´ng dÃ¹ng dropdown)
- Animation giá»¯a cÃ¡c bÆ°á»›c (framer-motion)
- Mobile-first responsive

### Skip & Resume
- Cho phÃ©p skip tá»«ng layer
- LÆ°u progress Ä‘á»ƒ resume sau
- Badge nháº¯c nhá»Ÿ trÃªn Portal náº¿u chÆ°a hoÃ n thÃ nh

### Personalization Result
- CEO â†’ FDP Dashboard + Control Tower alerts
- CFO â†’ Full FDP + Scenario Planning
- CMO â†’ MDP focus + Marketing Mode
- Marketer â†’ MDP Marketing Mode only
